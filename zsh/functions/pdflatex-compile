# Compile a LaTeX document

pdflatex-compile () {
    # Set LATEXNAME
    local LATEXNAME
    LATEXNAME=${*%\.(|tex)}

    # Clear out stale files
    rm -f "${LATEXNAME}.aux" "${LATEXNAME}.bbl" "${LATEXNAME}.blg" "${LATEXNAME}.log" "${LATEXNAME}.out" "${LATEXNAME}.pdf"

    # First pass compilation
    pdflatex ${LATEXNAME}

    # If we have a \bibliography command that isn't commented out, then do some more compilation
    if [[ `grep -c '^[^%]*\\\bibliography{' "${LATEXNAME}.tex"` -gt 0 ]]; then
        bibtex ${LATEXNAME}
        pdflatex ${LATEXNAME}
    fi

    # Final pass
    pdflatex ${LATEXNAME}

    # Tidy up
    rm -f "${LATEXNAME}.aux" "${LATEXNAME}.bbl" "${LATEXNAME}.blg" "${LATEXNAME}.log" "${LATEXNAME}.out"

    # Success is determined by the existence of a PDF
    if [[ -a "${LATEXNAME}.pdf" ]]; then
        return 0
    else
        return 1
    fi
}
