# When mutt starts up, decrypt passwords
set my_mythicbeasts_user = "`gpg --batch -q -d ${XDG_CONFIG_HOME}/offlineimap/secrets.gpg | grep '^mythic-beasts:user:' | cut -d ':' -f 3`"
set my_mythicbeasts_pass = "`gpg --batch -q -d ${XDG_CONFIG_HOME}/offlineimap/secrets.gpg | grep '^mythic-beasts:pass:' | cut -d ':' -f 3`"
set my_tarandy_clientid = "`gpg --batch -q -d ${XDG_CONFIG_HOME}/offlineimap/secrets.gpg | grep '^tarandy:oauth2_client_id:' | cut -d ':' -f 3`"
set my_tarandy_clientsecret = "`gpg --batch -q -d ${XDG_CONFIG_HOME}/offlineimap/secrets.gpg | grep '^tarandy:oauth2_client_secret:' | cut -d ':' -f 3`"
set my_tarandy_refreshtoken = "`gpg --batch -q -d ${XDG_CONFIG_HOME}/offlineimap/secrets.gpg | grep '^tarandy:oauth2_refresh_token:' | cut -d ':' -f 3`"
set my_imperial_user = "`gpg --batch -q -d ${XDG_CONFIG_HOME}/offlineimap/secrets.gpg | grep '^imperial:user:' | cut -d ':' -f 3`"
set my_imperial_pass = "`gpg --batch -q -d ${XDG_CONFIG_HOME}/offlineimap/secrets.gpg | grep '^imperial:pass:' | cut -d ':' -f 3`"
set my_icloud_user = "`gpg --batch -q -d ${XDG_CONFIG_HOME}/offlineimap/secrets.gpg | grep '^icloud:user:' | cut -d ':' -f 3`"
set my_icloud_pass = "`gpg --batch -q -d ${XDG_CONFIG_HOME}/offlineimap/secrets.gpg | grep '^icloud:pass:' | cut -d ':' -f 3`"
set my_doctors_user = "`gpg --batch -q -d ${XDG_CONFIG_HOME}/offlineimap/secrets.gpg | grep '^doctors:user:' | cut -d ':' -f 3`"
set my_doctors_pass = "`gpg --batch -q -d ${XDG_CONFIG_HOME}/offlineimap/secrets.gpg | grep '^doctors:pass:' | cut -d ':' -f 3`"

source $XDG_CONFIG_HOME/mutt/account.mythic-beasts

# behaviour
set abort_noattach = ask-yes
set nobeep
set noconfirmappend
set delete = yes
set fast_reply
set include = yes
set nomark_old
set recall = no
set nowait_key
set sleep_time = 0
set header_cache = $XDG_CACHE_HOME/mutt/

set text_flowed = yes
set send_charset = "utf-8"
set query_command = "icloud-addressbook-query.py '%s'"
auto_view = text/html

set print_command = "if [ -a ${HOME}/Desktop/muttprint.pdf ]; then echo '~/Desktop/muttprint.pdf exists, aborting'; exit 1; else muttprint -p - -i off -P A4 -e local -E '%A %d %B %Y %H:%M %Z' | ps2pdf - ${HOME}/Desktop/muttprint.pdf; fi"
set print_split

# display
set attribution = "%n <%a> wrote [%{%Y-%m-%d %H:%M %z}]:"
set forward_format = "Fwd: %s"
set nohelp
set menu_context = 5
set menu_scroll
set read_inc = 500
set pager_stop
set nomarkers
set wrap = 80
set strict_threads
set sort = reverse-threads
set sort_aux = last-date-received

alternative_order text/plain text/enriched text/html
unhdr_order *
hdr_order Date: From: Reply-To: To: Cc: Subject:
folder-hook . 'exec collapse-all'

set index_format = "%4C (%Z) %[%Y-%m-%d %H:%M] %25.25F : %?M?(%M) ?%s "
set pager_format = " Message: %C/%m %> Attachments: %X "
set status_chars = " *%A"
folder-hook . 'set status_format = " Mutt: $from%?r?%r? %>  %?V?Limit:%V | ?Msgs:%?M?%M/?%m%?n? New:%n?%?d?  Del:%d?%?F? Flag:%F?%?t? Tag:%t?%?p? Post:%p? "'

# sidebar
set sidebar_visible = yes
set sidebar_format = "%B%> %?N?%N? "
set sidebar_sort_method = unsorted
set mail_check_stats

# identities
alternates andrewho@andrewho.co.uk
alternates andrewlkho@icloud.com
alternates andrewlkho@cantab.net
alternates andrewlkho@doctors.org.uk
alternates tarandy133@gmail.com
alternates andrew.ho08@imperial.ac.uk

ignore *
unignore From: To: Date: Subject: Cc: Reply-To:

set mailcap_path = $XDG_CONFIG_HOME/mutt/mailcap
source $XDG_CONFIG_HOME/mutt/keybindings
source $XDG_CONFIG_HOME/mutt/colours
